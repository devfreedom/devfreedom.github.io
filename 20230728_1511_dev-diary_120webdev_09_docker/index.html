<!DOCTYPE html>
<html>
    
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>[Dev Diary] 120 Days of WebDev - 9. Docker | devfreedom.github.io</title>
    <meta name="title" content="[Dev Diary] 120 Days of WebDev - 9. Docker | devfreedom.github.io">
    <meta name="description" content="devfreedom&#39;s personal blog">
    <meta name="keywords" content="❮Dev Diary❯,web development,containerization,virtualization,eleventy,template,simple,clean">
    <meta name="author" content="devfreedom">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://devfreedom.github.io/20230728_1511_dev-diary_120webdev_09_docker/">
    <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.svg">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
    <link rel="stylesheet" href="/assets/css/main.css">
    
</head>	

<body class="flex flex-col h-screen bg-white text-gray-800 break-words">
    <header id="header" class="header-shadow bg-black px-6 py-5 z-50 fixed w-full top-0 transition-all transform ease-in-out duration-500">
    <div class="max-w-5xl mx-auto flex items-center flex-wrap justify-between">
        <div class="sm:mr-8">
            <a class="flex items-center" href="/">                              
                <span class="text-lg text-white font-semibold self-center">devfreedom.github.io</span>
            </a>
        </div>
        <nav id="menu" class="order-last md:order-none items-center flex-grow w-full md:w-auto md:flex hidden mt-2 md:mt-0">
            
            <a href="/tags" class="block mt-4 md:inline-block md:mt-0 font-medium text-gray-500 hover:text-white text-base mr-7">Categories</a>
            
            <a href="https://github.com/devfreedom" target="_blank" rel="noopener" class="block mt-4 md:inline-block md:mt-0 font-medium text-gray-500 hover:text-white text-base mr-7">GitHub</a>
            
            <a href="/about" class="block mt-4 md:inline-block md:mt-0 font-medium text-gray-500 hover:text-white text-base mr-7">About</a>
            
        </nav>
        <form id="search" action="/search" class="order-last sm:order-none flex-auto w-32 items-center justify-end hidden sm:block mt-6 sm:mt-0">
            <label class="visually-hidden" for="header-searchbox">Search here ...</label>
            <input type="text" id="header-searchbox" name="q" placeholder="Search..." class="w-full sm:max-w-xs bg-gray-200 border border-transparent float-right focus:bg-white focus:border-gray-300 focus:outline-none h-8 p-4 placeholder-gray-700 rounded text-gray-700 text-sm">
        </form>
        <div id="menu-toggle" class="flex items-center md:hidden text-gray-700 hover:text-teal-600 cursor-pointer sm:ml-6">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
</svg>
        </div>
    </div>
</header>
    <main class="mx-7 lg:mx-6 mt-32 flex-grow">
        
        
<article class="max-w-5xl mx-auto">
    <header class="mb-14">
        <h1 class="text-3xl text-center font-bold leading-normal text-gray-900 mt-0 mb-3">[Dev Diary] 120 Days of WebDev - 9. Docker</h1>
        <div class="text-center">Published on 28 July 2023 03:11 PM</div>
        
        <div class="mt-3 text-center">
            
            <a href="/tags/❮Dev Diary❯" class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-medium text-gray-700 m-0.5">#❮Dev Diary❯</a>
            
            <a href="/tags/web development" class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-medium text-gray-700 m-0.5">#web development</a>
            
            <a href="/tags/containerization" class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-medium text-gray-700 m-0.5">#containerization</a>
            
            <a href="/tags/virtualization" class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-medium text-gray-700 m-0.5">#virtualization</a>
            
        </div>
        
        
        <div class="mt-10 -mx-7 md:mx-0">
            <img class="w-full max-w-2xl mx-auto" src="/assets/img/docker-logo.png" width="960" height="500" alt="This post thumbnail">
        </div>
        
    </header>
    <div id="content" class="prose text-gray-800 max-w-none">
        <p>Since I have studied and covered theoretical background knowledge about containerization, virtualization, and Docker in a DevOps study note already, this will be mostly about an introductory hands-on experience and knowledge.</p>
<hr>
<h1>1. Docker</h1>
<h2>1-1. Introduction</h2>
<h3>Prerequisites</h3>
<ol>
<li>Install <a href="https://docs.docker.com/engine/install/ubuntu/">Docker Engine</a>.</li>
<li>Install <a href="https://docs.docker.com/desktop/install/linux-install/">Docker Desktop</a> for GUI convenience.</li>
</ol>
<h3>Pull and Run a Docker Image</h3>
<ol>
<li>Pull a sample image from Docker Hub.<pre><code>$ docker pull docker/getting-started
</code></pre>
</li>
<li>Run the image as a container.<pre><code>$ docker run -d -p 80:80 docker/getting-started
</code></pre>
</li>
<li>Access to the running container.
<ul>
<li>Go to http://localhost:80 then you'll see Getting Started website running locally.</li>
<li>Run <code>curl http://localhost:80</code> to see the actual data.</li>
</ul>
</li>
</ol>
<h3>Docker Commands</h3>
<ul>
<li><code>docker images</code>
<ul>
<li>List all installed Docker images.</li>
</ul>
</li>
<li><code>docker ps</code>
<ul>
<li>= <code>docker container</code></li>
<li>List running Docker containers.</li>
<li>Options
<ul>
<li><code>-a</code>
<ul>
<li>List all containers.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>docker create [OPTIONS] [IMAGE] [COMMAND]</code>
<ul>
<li>Docker create command creates a fresh new container from a docker image. However, it doesn’t run it immediately.</li>
</ul>
</li>
<li><code>docker start [OPTIONS] [CONTAINER]</code>
<ul>
<li>Docker start command will start any stopped container. If you used docker create command to create a container, you can start it with this command.</li>
</ul>
</li>
<li><code>docker run [OPTIONS] [IMAGE] [COMMAND]</code>
<ul>
<li>Docker run command is a combination of create and start as it creates a new container and starts it immediately.</li>
<li>The docker run command can even pull an image from Docker Hub if it doesn’t find the mentioned image on your system.</li>
<li>Options
<ul>
<li><code>--detach</code>
<ul>
<li>= <code>-d</code></li>
<li>Run container in background and print container ID</li>
</ul>
</li>
<li><code>--publish [host_port]:[container_port]</code>
<ul>
<li>= <code>-p [host_port]:[container_port]</code></li>
<li>Publish a container’s port(s) to the host</li>
<li>e.g. If we wanted to expose port 8080 inside the container to port 3000 outside the container, we would pass 3000:8080 to the --publish flag.</li>
</ul>
</li>
<li><code>--interactive</code>
<ul>
<li>= <code>-it</code></li>
<li>This command it takes you straight inside the container.</li>
</ul>
</li>
<li><code>--name [container_name]</code>
<ul>
<li>Name the container.</li>
</ul>
</li>
<li><code>--env</code>
<ul>
<li>= <code>-e</code></li>
<li>Set environment variables.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>docker restart [OPTIONS] [CONTAINER]</code>
<ul>
<li>Restart the container.</li>
</ul>
</li>
<li><code>docker rm [CONTAINER]</code>
<ul>
<li>= <code>docker container rm [CONTAINER]</code></li>
<li>Remove the container.</li>
</ul>
</li>
<li><code>docker rmi [IMAGE]</code>
<ul>
<li>= <code>docker image rm [IMAGE]</code></li>
<li>Removes (and un-tags) one or more images from the host node.</li>
<li>If <code>Error response from daemon: conflict: unable to remove repository reference &quot;image_name&quot;</code> happens,
<ul>
<li>List all containers by using <code>docker container ls -a</code>.</li>
<li>Remove all idle containers that are using the image, one-by-one.</li>
<li>Remove the image.</li>
</ul>
</li>
</ul>
</li>
<li><code>docker stop [OPTIONS] [CONTAINER]</code>
<ul>
<li>The docker stop commands issue the SIGTERM signal.
<ul>
<li>SIGTERM gracefully terminates a process rather than killing it immediately.</li>
<li>SIGTERM allows a child process or parent process the opportunity to send information to other processes.</li>
</ul>
</li>
<li>If the command fails to terminate a process within the specified timeout, the Docker issues a kill command implicitly and immediately.</li>
</ul>
</li>
<li><code>docker kill [OPTIONS] [CONTAINER]</code>
<ul>
<li>The docker kill commands sends the SIGKILL signal.
<ul>
<li>It is not possible to handle, ignore or block a SIGKILL signal</li>
<li>The killed child process doesn't get to notify its parent that it received the kill signal.
<ul>
<li>It might create zombie processes.</li>
</ul>
</li>
</ul>
</li>
<li>The docker kill command causes an unsafe exit.</li>
<li>The container needs some time to shut down completely.</li>
</ul>
</li>
<li><code>docker exec [OPTIONS] [CONTAINER] [COMMAND]</code>
<ul>
<li>The docker exec command runs a new command in a running container.</li>
<li>e.g. <code>docker exec -it my-container /bin/sh</code></li>
</ul>
</li>
<li><code>docker build [OPTIONS] [PATH] [URL]</code>
<ul>
<li>The docker build command builds Docker images from a Dockerfile and a “context”.
<ul>
<li>A build’s context is the set of files located in the specified PATH or URL.</li>
</ul>
</li>
</ul>
</li>
<li><code>docker push [OPTIONS] [NAME][:TAG]</code>
<ul>
<li>Upload an image to a registry</li>
<li>To build and push an image,
<ol>
<li><code>docker build -t [user_name]/[image_name][:version]</code></li>
<li><code>docker push [user_name]/[image_name][:version]</code></li>
</ol>
</li>
</ul>
</li>
</ul>
<h2>1-2. Dockerfile</h2>
<h3>Build a Docker Image using Dockerfile</h3>
<ul>
<li>Dockerfile instruction components
<ul>
<li><code>#</code>
<ul>
<li>Comment</li>
</ul>
</li>
<li><code>FROM</code>
<ul>
<li>Set the base image</li>
</ul>
</li>
<li><code>MAINTAINER</code>
<ul>
<li>Image creator description</li>
</ul>
</li>
<li><code>LABEL</code>
<ul>
<li>Metadata in key-value pairs</li>
</ul>
</li>
<li><code>RUN</code>
<ul>
<li>Execution commands for building a container</li>
</ul>
</li>
<li><code>COPY</code>
<ul>
<li>Copy host files upon building a container</li>
</ul>
</li>
<li><code>ADD</code>
<ul>
<li>Copy files from the local storage to a destination in the Docker image.</li>
<li>Copy a tarball from the local storage and extract it automatically inside a destination in the Docker image.</li>
<li>Copy files from a URL to a destination inside the Docker image.</li>
</ul>
</li>
<li><code>WORKDIR</code>
<ul>
<li>The working directory for commands to be fired upon building a container</li>
</ul>
</li>
<li><code>ENV</code>
<ul>
<li>Environment variables</li>
</ul>
</li>
<li><code>USER</code>
<ul>
<li>Set the user for container and commands, root by default</li>
</ul>
</li>
<li><code>VOLUME</code>
<ul>
<li>Mount a specific directory inside the container, to the external path</li>
</ul>
</li>
<li><code>EXPOSE</code>
<ul>
<li>Set a port exposed outside the container</li>
</ul>
</li>
<li><code>CMD</code>
<ul>
<li>Services and scripts to run automatically upon running a container</li>
</ul>
</li>
<li><code>ENTRYPOINT</code>
<ul>
<li>Configure the executables that will always run after the container is initiated</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>1-3. Docker-compose</h2>
<ul>
<li>Build multiple Docker images and run multiple Docker containers at once</li>
<li>Configure multiple containers by using <em>docker-compose.yaml</em> file</li>
</ul>
<h2>1-4. Hands-on</h2>
<h3>Build and Run a Flask App</h3>
<ol>
<li>Write a Dockerfile.<pre><code># Uses a minimal &quot;alpine&quot; Docker image based on Alpine Linux,
# with a complete package index and only 5 MB in size
FROM python:3.8-alpine

# Copy all files into /app
COPY . /app

# Working directory would be /app
WORKDIR /app

# Install Flask upon building the container
RUN pip3 install flask

# Also, give app.py an execution permission
RUN chmod +x /app/app.py

# When the container runs, execute app.py
CMD [&quot;python3&quot;, &quot;app.py&quot;]
</code></pre>
</li>
<li>Build an image using Dockerfile.<pre><code>$ docker build -t flask-app
</code></pre>
</li>
<li>Run the image as container.<pre><code>$ docker run –d –p 5000:5000 flask-app
</code></pre>
</li>
</ol>
<h3>Pull MySQL 8.0 from Docker Hub and Run</h3>
<ol>
<li>Search MySQL.<pre><code>$ docker search mysql --limit 5
</code></pre>
</li>
<li>Pull MySQL automatically and run.<pre><code>$ docker run -d -p 3306:3306 \
    --name docker-mysql \
    mysql:8.0 \
    -e MYSQL_ALLOW_EMPTY_PASSWORD=true
</code></pre>
<ul>
<li>The docker run command can even pull an image from Docker Hub if it doesn’t find the mentioned image on your system.</li>
</ul>
</li>
<li>Check the status.<pre><code>$ docker images
$ docker ps
</code></pre>
</li>
<li>Run Bash inside the container. Alternatively you can use Docker Desktop GUI as well.<pre><code>$ docker exec -it docker-mysql bash
</code></pre>
</li>
<li>Run MySQL.<pre><code>$ mysql -u root -p
</code></pre>
</li>
</ol>
<h2>1-5. Protips</h2>
<h3>Making Docker Image Compact</h3>
<ul>
<li>Pick the most lightweight base image.
<ul>
<li>e.g.
<ul>
<li>Alpine</li>
<li>Debian slim</li>
<li>Debian buster</li>
</ul>
</li>
</ul>
</li>
<li>Minimize image layer count.
<ul>
<li>A Docker build consists of a series of ordered build instructions.</li>
<li>Each instruction in a Dockerfile roughly translates to an image layer.</li>
<li>Less layers, more compact.</li>
</ul>
</li>
<li>Reorder Dockerfile instructions efficiently.
<ul>
<li>The order of Dockerfile instructions matter.
<ul>
<li>When you run a build, the builder attempts to reuse layers from earlier builds by caching layers.</li>
</ul>
</li>
<li>Ordering your Dockerfile instructions appropriately helps you avoid unnecessary work at build time.
<ul>
<li>e.g.
<ul>
<li>Copy dependency tracker first, and then run download, and then copy all files. So that only actual changes in dependencies are performed.</li>
<li>Put frequently-changing instructions and operations at the bottom of the Dockerfile.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Download, keep, and use necessary dependencies only.
<ul>
<li>e.g. Remove unused dependencies using <code>npm prune</code></li>
</ul>
</li>
<li>Use multi-stage build.
<ul>
<li>In a Dockerfile, a build stage is represented by a FROM instruction.
<ul>
<li>One build stage means that the final image is bloated with resources used to compile the program.</li>
</ul>
</li>
<li>Using multi-stage builds, you can choose to use different base images for your build and runtime environments.
<ul>
<li>You can copy build artifacts from the build stage over to the runtime stage.</li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
    
    <div class="mt-20 md:mt-32 lg:mt-32 xl:mt-32"></div>
</article>
        
    </main>
    <footer class="mt-20 px-10 py-8 bg-gray-200">
    <div class="max-w-5xl mx-auto text-gray-700 text-center">
        © 2022 <a href="/" class="font-medium" target="_blank" rel="noopener">devfreedom.github.io</a> by 
        <a href="https://devfreedom.github.io" target="_blank" rel="noopener">devfreedom</a> 
    </div>
</footer>
    <script src="/assets/js/bundle.js"></script>
</body>

</html>