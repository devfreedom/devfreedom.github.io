---
title: "[필기] 컴퓨터공학과 <데이터베이스> 과목 - 후반부"
date: 2024-02-07T19:31
thumb: "database.jpg"
tags: 
    - ❮필기❯
    - 컴퓨터공학
    - 데이터베이스
    - DBMS
    - RDBMS
    - SQL
---

# 4. 관계 (relationship)

## 4-1. 관계의 개념
- 데이터 모델에서의 정의
    - 엔티티 사이의 논리적인 연관성
    - 존재의 형태나 행위로써 서로에게 연관성이 부여된 상태
    - 엔티티 안에 있는 인스턴스가 개별적으로 연관 관계를 가지고 있음
        - 이것들의 집합을 '관계'라고 표현함
        - 각 인스턴스가 각각 다른 종류의 관계를 가지는 경우 두 엔티티 사이에 두 개 이상의 관계가 형성될 수 있음
    - 개체 = 논리적으로 표현된 '인스턴스의 집합'
    - 관계 = 논리적으로 표현된 '관계 페어링(pairing)과 어커런스(occurrence)'
- 관계의 분류
    - 존재에 의한 관계
        - 특정 이벤트를 필요로 하지 않고 자연적인 존재상태에 의해 발생하는 관계
            - 주로 '기본 식별자/엔티티'가 여기에 해당됨
        - 예: '총무과'에 '김진성 사원'이 소속되어 있음
    - 행위에 의한 관계
        - 특정 사건/이벤트/행위에 의해 발생하는 관계
            - 주로 '주요/행위 식별자/엔티티'가 여기에 해당됨
        - 예: 고객이 카드 결제를 시도해서 '승인번호'가 생성됨
            - '카드 결제'라는 행위로 인해 발생
- 관계 표현
    - 이항(binary) 관계
        - 예: '강의'가 '교수'와 '과목'과 연결되어 있는 경우
    - 삼항(ternary) 관계
        - 예: '소속'이 '교수'와 '학과'와 '학생'과 연결되어 있는 경우
    - N항(N-ary) 관계
        - 실제로 나타나는 경우는 거의 없음
- 멤버십 (membership)
    - 각 관계에는 두 개의 상호 연결, 즉 '멤버십'이 나타나고, 두 가지의 관점으로써 표현됨
        - 예: '총무과'는 '김진형 사원'을 포함 = '김진형 사원'은 '총무과'에 소속
        - 관계의 시작점 = 엔티티에서 관계가 시작되는 쪽
        - 관계의 끝점 = 엔티티에서 관계를 받는 쪽
- 관계명
    - 관점에 따라 능동적이거나 수동적으로 명명됨
    - 원칙
        - 현재형으로 표현할 것
            - 예: '수강신청 예정'이 아닌 '수강신청'
        - 애매한 동사를 피할 것
            - 예: '회계 관련 업무'가 아닌 '회계 업무'
- 관계의 선택성
    - "관계에 참여하는 엔티티 집합의 인스턴스가 항상 관계에 참여해야 하는가?"의 여부
        - 필수(mandatory) or 선택(optional)
        - 여기서 '선택' 참여 처리되는 속성은 foreign key로 참조될 경우 null값을 허용할 수 있게 됨
    - 만약 선택참여로 지정해야 할 관계를 필수참여로 지정해버리면?
        - 데이터가 발생하면 이를 반드시 한 개의 트랜잭션으로써 제어해야 하는 제약사항이 생기는 문제가 발생함
        - 관계의 선택 사양 설정을 잘못하면 참조 무결성 제약조건에 영향을 미칠 수 있음
        - 비즈니스 로직 개발에 큰 영향을 미치므로 설계 과정에서 신중하게 결정해야 함

### 관계의 차수
- 두 엔티티간 관계에서의 '참여자의 수'를 의미함
- one-to-many (1:M)
    - 가장 흔하게 나타나는 매우 일반적인 형태
    - 부모-자식 관계처럼 계층적이라고 이해하면 쉬움
    - 참조하는 대상이 상위 항목이어야 집합에 변화가 생기지 않으므로, many가 아니라 one을 참조하는 관계
        - 필수-필수 관계
            - 현실에서 가끔 발생하는 형태
            - 예: '구매'라는 업무에 있어서 하나의 '주문'이 한 개 이상의 '제품'들을 반드시 포함해야만 하는 경우
                - 주문이 발생하면 제품도 반드시 존재해야 함 = 구입할 제품이 없는 주문은 의미가 없음
                - 구매할 제품이 있다면 주문도 발생해야 함 = 주문이 없는 제품은 구매의 의미가 없음
        - 선택-필수 관계
            - 가장 흔하게 발생하는 형태
            - 예: '인사관리' 업무에 있어서 하나의 '부서'와 한 명 이상의 '사원'들의 관계
                - 모든 부서가 '사원'을 포함하지는 않으나, = 선택
                    - 신생 부서의 경우 사원이 없을 수 있음
                - 모든 '사원'은 어떠한 '부서'에든 속해야 함 = 필수
        - 필수-선택 관계
            - 현실에서 가끔 발생하는 형태
            - 예: 여러 구매자들이 모여 그 규모에 비례하는 할인율로 특정 제품을 구입하는 '소셜 공동구매'라는 업무에 있어서, 하나의 '상품'과 한 명 이상의 '고객'들의 관계 
                - 소셜 공동구매를 통해 판매가 이루어져야 할 '상품'은 반드시 존재해야 하지만, = 필수 
                - 모든 고객들이 해당 상품을 구매해야 하는 것은 아님 = 선택
                    - 제품 구매 의사에 따라 고객은 소셜 공동구매에 참여를 할 수도 있고 안할 수도 있음
                    - 소셜 공동구매에 참여할 고객의 목록이 최종 결정되고 나서야 상품 판매가 의미를 가짐
        - 선택-선택 관계
            - 흔하게 발생하는 형태
            - 관계의 선택성이 증가할수록 모델의 모호성이 증가될 수 있으므로 이를 해소해야 함
            - 예: '여행상품 판매'에 있어서 '고객'과 '예약'의 관계
                - 고객이 없더라도 예약을 미리 잡을 수 있음
                - 예약이 없더라도 고객은 존재할 수 있음
- 1:1
    - 엔티티 타입이 독립적으로 분리되면서 상호간에 하나의 관계만 성립함
        - 필수-선택 관계
            - 한 엔티티에 대응되는 상대 엔티티는 반드시 존재하나, 그 반대는 존재하지 않을수도 있음
        - 필수-필수 관계
            - 두 엔티티가 같은 경우
        - 선택-선택 관계
            - 거의 발생하지 않음
    - 현실적으로 흔하게 나타나지는 않음
    - 개체의 수직 분할에서 많이 나타나며, 업무 흐름에 따라 데이터가 설계된 형태에서 주로 발생
- many-to-many (M:M)
    - 관계를 가진 양쪽 당사자 모두에서 1:M 관계가 존재하는 형태
    - 데이터 모델링이 완료되었다면 M:M 관계는 더이상 존재하지 않음
        - M:M 관계가 발견되었다면 데이터 모델링이 완전하지 않은 상태이므로 M:M 관계를 해소해야 함
        - M:M 관계를 해소하면 새로운 릴레이션 엔티티가 생성되게 됨

## 4-2. 관계 도출

### 관계 정의 과정
1. 관계를 정의할 수 있는 두 핵심 엔티티간의 관계를 도출
    - 두 엔티티간에 업무적 연관성을 가지고 쌍방의 관점을 가지고 있는 핵심 엔티티를 선정
        - 기존 시스템 문서에서 동사 구분
        - 도출된 핵심 엔티티와 관계를 이용해 관계 정의 작성 후 세분화
2. 핵심 엔티티간의 관계성을 정의
    - 관계를 통해 정보의 활용가치를 상승시키도록 정합성을 유지
    - 기수성/차수/degree/cardinality를 검토
        - one or many
    - 선택성을 검토
        - 주로 one(선택/referenced)-to-many(필수/referencing) 관계가 가장 흔함
        - one쪽 엔티티에 many쪽 엔티티들이 필수적으로 참여하도록 설계하는 것이 바람직함
    - 관계명 정의
        - 두 개의 관계 멤버십에 상대방 입장에서의 관계명을 기술하도록 각각 부여
        - 업무적 연관성을 나타내는 이름을 현업에서 사용하는 간결한 현재 시제 동사형으로 부여
        - 업무적 의미가 없거나 애매모호한 용어 배제
3. 식별 관계 설정
    - 식별 관계 = 강한 엔티티와 약한 엔티티의 관계 = 존재/존속 관계
        - 식별 = 부모 엔티티의 식별자가 자식 엔티티의 주 식별자의 일부가 되는 경우
        - 비식별 = 부모 엔티티의 주 식별자가 자식 엔티티의 non-key 영역으로 이주하고 자식을 식별하는 데 관여하지 않음
4. 관계의 성격을 구분해 관계를 확정하기
    1. 관계 도출해내기
        - 엔티티 타입 도출에 사용되었던 6가지 방법과 동일 
            - 엔티티가 '명사형'이라면 관계는 '동사형'으로써 구분될 수 있음
                - 예: 학원
                    - 강사는 여러개의 강좌를 강의할 수 있다.
                    - 학원에서는 여러 명의 강사를 관리한다.
                    - 학원해서 개설한 강좌는 강사 1명이 강의를 진행한다.
                    - 동사: 강의한다, 관리한다, 개설한다
            - 이를 관계 정의서 또는 ERD로 표현한 후 정제 과정을 거침
        - 관계라는 것은 기존 업무 문서에 정확하게 기술되어 있는 경우는 거의 없으므로 내용을 보고 관계를 유추해내야 함
    2. 도출된 엔티티들과 관계를 기반으로 관계 정의서를 작성
        - 예: '사원' 엔티티 타입의 관계 정의서
            - 관계: 각 사원은 한 부서에 속한다. 각 부서에는 여러 사원들이 존재할 수 있다.
                - 참여: 사원(필수) - 부서(선택)
                - 관련 엔티티 타입: 부서
            - 관계: 각 사원은 여러 주문을 접수할 수 있다. 각 주문은 한 명의 사원에 의해서만 접수된다.
                - 참여: 사원(선택) - 주문(필수)
                - 관련 엔티티 타입: 주문
    3. 고객에게 질문과 인터뷰를 통해 도출된 관계를 세분화/구체화하기
        - "각 (기준 엔티티)는 (하나의 or 여러) (관련 개체) (만/항상) (소속할/소속될) 수 있는가?"
            - "각 (엔티티1)은 하나의 (엔티티2)에 속합니까?" = 1:1?
            - "각 (엔티티1)은 여러 (엔티티2)에도 소속될 수 있습니까? = 1:M?
            - "각 (엔티티1)은 (엔티티2)에 속하지 않을 수도 있습니까?" = 선택참여/필수참여? 
    4. 데이터 모델링 도구 등을 이용해 모델을 직접 그려보기
        - 의사소통 향상
        - 엔티티 타입 배치 용이
        - 관계 설정/수정이 쉬움
    5. 고객과 질문하고 협의해 모델을 검토
        - ERD를 그리기 전에는 고객과 인터뷰를 진행
        - ERD를 그리고 나면 관계가 정확히 설정되었는지, 누락된 것은 없는지 고객과 검토
        - 고객의 의견을 모두 반영해야 하는 것은 아님
            - 현업 현직자들은 현재의 업무 흐름에 익숙해져 있으므로 변화에 보수적일 수 있음

### 관계 검토
- 엔티티 타입간의 업무적 연관성을 정의한 결과물을 검증해야 할 필요가 있음
- 엔티티 타입간에 M:M 관계가 남아있는가?
    - M:M 관계는 남아있지 않아야 함
        - 프로젝트를 진행하던 도중 도출되지 않은 업무 규칙이 발견되거나, 업무 규칙이 새로 추가되는 상황에서 발생함
        - 관계 타입을 발생시키는 업무 규칙이 발견되었다면 일단 무조건 ERD상에 표현해야 함
        - 그리고 나서 관계 타입이 반드시 별도로 존재해야 하는지를 검토
    - 해소 방법
        - 관계 타입의 분리
            - 예: 요금 납부 업무
                - 하나의 요금이 여러번 납부될 수 있음 = 1:M
                - 여러 요금이 한 번에 납부될 수 있음 = M:1
                - 이렇게 M:M 관계가 발생한 경우 1:M 형식으로 분리해서 해소를 해야 함
                    - 여기서는 엔티티 발생 순서대로 '요금'과 '납부'를 이어 붙여 명명한 새로운 '요금납부'라는 관계 타입을 만들어 분리함
                        - '요금'과 '요금납부' = 1:M
                        - '요금납부'와 '납부' = M:1
        - 주 식별자 통합
            - 관계 타입의 분리를 통해 M:M을 해소하게 되면 ERD가 복잡해질 수 있음
            - PK를 사용해 하나의 엔티티 타입으로 통합하는 방식으로도 해소가 가능함
                - 예: 요금 납부 업무
                    - 요금의 주 식별자 = 요금번호
                    - 납부의 주 식별자 = 납부번호
                        - 납부의 주 식별자를 '납부번호 + 요금 납부 순차 번호' 형식으로 바꾸면 됨
                            - 한 번의 납부로도 여러 요금고지서의 납부가 가능한 형태가 됨
            - 장점
                - 엔티티 타입의 통합을 통해 데이터 모델 복잡도 감소
                - 물리적 테이블에서 데이터를 가져올 때 여러 테이블에 대한 JOIN을 하지 않음
                - 트랜잭션 수가 적지만 반드시 업무에 필요한 경우에 적용함
            - 유의사항
                - 부모 엔티티와 자식 엔티티의 생사가 같아야만(존재 종속) 가능함
                - 통합되는 엔티티 타입의 속성이 많고, 데이터 수정이 빈번하며, 쓰기 작업 위주의 엔티티 타입에는 사용하기 어려움
                    - 데이터 수정이 빈번한 경우에는 여러 튜플에 대한 작업이 발생하므로 좋지 않음
                - 속성이 많아질 경우 데이터의 불필요한 반복과 중복이 발생
        - 부모 엔티티 타입에 대한 속성 추가
            - 예: 요금 납부 업무에서 만약 분할 납부가 최대 2번까지만 가능하다는 규칙이 있는 경우
                - 요금(요금번호) -> 요금(요금번호, 납부번호1 FK, 납부번호2 FK)
            - 유의사항
                - 해당 업무 규칙의 최대값이 지정되어 있고, 그것이 변경될 가능성이 낮아야 함
                    - 최대값이 3~4개 이상이거나 지속적으로 변동될 가능성이 크다면 이에 따라 애플리케이션도 변경되어야 하므로 확실한 경우에만 적용해야 함
- 엔티티 타입간의 관계는 업무 흐름과 프로토콜에 일치하는가?
    - 선택성 관련 이슈
        - 한쪽을 필수 관계로 지정하는 이유 = 참조하는 쪽에서 물리 테이블을 생성하면 FK로써 참조하기 때문
            - FK 참조 무결성을 보장하기 위함
        - 양쪽 모두를 선택 관계로 지정하는 경우는 모델의 모호성이 증가되므로 바람직하지는 않음
            - 다만 실무의 특수성으로 인해 불가피한 경우가 있음
    - 예: 사원에게 급여를 지급할 건이 발생되면 계산된 급여가 일단 급여 목록에 기록되고, 급여가 확정되면 그 때 전표가 자동 발생하는 업무 흐름
        - 전표(전표번호)와 급여(사원번호, 전표번호 FK)는 1(필수):1(필수) 관계일까? 
            - NO = 급여 지급건이 발생하더라도 그것이 확정되지 않는다면 전표가 생성되는 것이 아니므로 전표는 선택 참여 관계임 
- 업무 흐름에 비추어 봤을때, 도출되지 않거나 못한 관계가 남아있는가?
    - 엔티티 타입만 도출하고 관계 정의를 나중에 하려는 경우
        - 모델링을 수행하는 사람이 정확하게 인식하고 있는 경우라면 큰 문제는 없음
    - 단위 시스템간의 업무 연계가 정의되지 않은 경우
        - 매우 큰 문제가 됨
        - 팀 단위로 이루어지는 프로젝트 개발에서는 단위 시스탬 내부의 연계는 대부분 도출되나 타 시스템과의 연계에는 취약함
            - 시스템 통합 관점에서의 전사적 모델링 통합 작업이 필요함
- 관계에 대한 표현이 적절한 수준에서 이루어졌는가?
    - 엔티티 타입간의 PK들을 보면 마치 모든 엔티티 타입들과 관계를 가지고 있는 것처럼 그물망 형식으로 나타남
    - 코드라던가 통계와 같이, 업무 흐름에 관여하는 모습을 직접 나타내지 않더라도 상식적으로 알 수 있는 엔티티 타입의 관계는 생략함
        - 나머지 주요 업무 흐름에 관련된 관계를 정의해서 표현해야 함
    - PK를 상속받은 엔티티 타입과 조상 엔티티 타입간의 관계 연결
        - 예: 사원(사원번호) -> 급여이력(사원번호 FK) -> 수당이력(사원번호 FK)
            - 사원과 수당이력 사이의 관계만 표현하여 간소화

# 5. Entity-Relationship Model

## 5-1. ER 모델의 개념

### 엔티티와 속성