---
title: "[러버덕 타임] 리눅스에서의 권한 관리?"
date: 2023-06-21T22:14
thumb: "rubber-duck.jpg"
tags: 
    - ❮러버덕❯
    - 컴퓨터공학
    - 데이터베이스
---

너무나도 낯선 리눅스의 권한 관리... 기본 개념을 다져봅시다.

---

## 리눅스의 접근 권한 관리

리눅스 시스템에서는 파일의 접근 권한을 상세하게 제어할 수 있습니다. 

리눅스에서 파일이나 디렉토리를 생성할 때는 접근 권한이 자동적으로 설정되는데 이를 '기본 접근 권한'이라고 합니다. 리눅스 시스템에서는 기본적으로 파일의 경우 소유자와 그룹에는 읽기/쓰기 권한이, 기타 사용자에게는 읽기 권한만 부여됩니다. 디렉토리의 경우 여기에 소유자, 그룹, 기타 사용자에게 '실행' 권한이 추가적으로 부여됩니다.

새로운 파일이나 디렉토리에 자동으로 부여되는 이러한 기본 접근 권한을 설정하기 위한 값을 '마스크(mask) 값'이라고 합니다. 그리고 이러한 마스크 값을 확인하거나 변경하기 위해서 umask라는 명령어를 사용합니다. umask는 'user mask'를 의미합니다.

다만 마스크 값은 '어떠한 권한을 부여할 것인가'를 지정하는 화이트리스트 방식이 아니라, '어떠한 권한을 박탈할 것인가'를 지정하는 블랙리스트 방식입니다. 우리가 어떠한 파일이나 디렉토리의 권한을 지정하고자 할 때는 chmod 명령어를 사용하는데, 이 명령어는 해당 파일이나 디렉토리가 '가져야 할 권한'을 '지정(정정)'해주는 방식입니다. 반면 umask 명령어는 파일이나 디렉토리가 가질 수 있는 최대 권한에서 '가져서는 안될 권한'을 지정해 '제거'하는 방식입니다. 명령어의 이름이 user mask인 이유가 바로 여기에 있습니다. 최대 권한으로부터 사용자가 가지면 안될 권한을 부분적으로 가려버리는(mask) 명령어이기 때문입니다.

umask로 기본 접근 권한을 변경하는 방법을 알아보기 전에 먼저 리눅스에서 권한을 8진법으로 표기하는 방법(octal representation)에 대해서 알아보겠습니다. 

## 리눅스에서의 권한 표기법

리눅스에서의 권한은 다음과 같이 읽기/쓰기/실행의 가능 여부를 나타내는 문자열들을 나열해서 나타냅니다.

- 파일: -rw-rw-rw-
- 디렉토리: drwxrwxrwx

맨 앞의 글자는 디렉토리 유무를 의미합니다. 어떠한 항목이 디렉토리라면 d를 가지게 되고, 디렉토리가 아니라면 - 로 대체합니다. 

여기서는 권한에 관해서만 설명하므로 앞으로 이 글자는 생략하겠습니다.

r은 읽기(read), w는 쓰기(write), x는 실행(execute) 권한을 나타냅니다. 만약 어떠한 권한이 없다면 해당 알파벳을 빈 칸으로 남기거나 지우는 대신 - 기호로 대체합니다.

디렉토리 유무인 첫 글자를 제외하고, 다음과 같이 세 글자 한 묶음으로 권한을 나타낼 수 있습니다.

- 권한 없음 = ---
- 실행만 가능 = --x
- 쓰기만 가능 = -w-
- 쓰기/실행 가능 = -wx
- 읽기만 가능 = r--
- 읽기/실행 가능 = r-x
- 읽기/쓰기 가능 = rw-
- 읽기/쓰기/실행 가능 = rwx

이러한 권한 한 묶음을 각각 소유자, 그룹, 기타 사용자에 대해서 적용하기 위해서 세 번 나열해주면 됩니다. 

예를 들어 어떠한 디렉토리가 rwxrw-r--이라는 권한을 가지고 있다고 해봅시다. 
- 이 문자열을 세 글자씩 나누어 보면 rwx / rw- / r-- 가 됩니다.
- 첫번째 항목은 '소유자'가 수행할 수 있는 권한, 두번째 항목은 '그룹'이 수행할 수 있는 권한, 세번째 항목은 '기타 사용자'가 수행할 수 있는 권한입니다. 
- 즉, 소유자는 읽기/쓰기/실행을 모두 할 수 있고, 그룹은 읽기와 쓰기만 할 수 있으며, 기타 사용자는 읽기만 할 수 있다는 의미입니다.

이제 이러한 권한 표기법을 8진법으로 변환해 봅시다.

- rwx-rw-r-- 권한을 나타내는 세 글자 알파벳을 각각 0과 1로 바꿔봅시다. 권한이 있다면 1, 권한이 없다면 0 입니다. 이진법 형태로 바꿔주는 작업입니다. 
    - rwx = 소유자 읽기 권한 있음(1), 소유자 쓰기 권한 있음(1), 소유자 실행 권한 있음(1)
    - rw- = 그룹 읽기 권한 있음(1), 그룹 쓰기 권한 있음(1), 그룹 실행 권한 없음(0)
    - r-- = 기타 사용자 읽기 권한 있음(1), 기타 사용자 쓰기 권한 없음(0), 기타 사용자 실행 권한 없음(0)
    - 즉, 111  110  100이 됩니다.
- 이렇게 나타낸 이진법 111 110 100을 8진법으로 바꿔주면 됩니다. 
    - 111 =  (1×2²) + (1×2¹) + (1×2⁰)= 4+2+1 = 7
    - 110 =  (1×2²) + (1×2¹) + (0×2⁰)= 4+2+0 = 6
    - 100 =  (1×2²) + (0×2¹) + (0×2⁰)= 4+0+0 = 4

이러한 원리로 권한을 다음과 같이 나타낼 수 있습니다.

- 권한 없음 = --- (문자열) = 000 (이진법) = 0+0+0 = 0 (8진법)
- 실행만 가능 = --x (문자열) = 001 (이진법) = 0+0+1 = 1 (8진법)
- 쓰기만 가능 = -w- (문자열) = 010 (이진법) = 0+2+0 = 2 (8진법)
- 쓰기/실행 가능 = -wx (문자열) = 011 (이진법) = 0+2+1 = 3 (8진법)
- 읽기만 가능 = r-- (문자열) = 100 (이진법) = 4+0+0 = 4 (8진법)
- 읽기/실행 가능 = r-x (문자열) = 101 (이진법) = 4+0+1 = 5 (8진법)
- 읽기/쓰기 가능 = rw- (문자열) = 110 (이진법) = 4+2+0 = 6 (8진법)
- 읽기/쓰기/실행 가능 = rwx (문자열) = 111 (이진법) = 4+2+1 = 7 (8진법)

즉, rwxrw-r-- 권한을 8진 표기법으로 나타낸 팔진값은 764가 됩니다. 이러한 표기법에 기반해, 리눅스에서 어떠한 디렉토리에 rwxrw-r--  권한을 부여하고 싶다면 chmod 764 명령어를 사용하면 됩니다.

## umask와 기본 접근 권한

이제 umask로 되돌아가봅시다. 위에서 언급했듯이 chmod가 '특정 파일과 디렉토리에게 어떠한 권한을 부여할지'를 지정하는 명령어라면, umask 명령어는 '새로 만들어지는 파일과 디렉토리가 어떠한 권한을 가질 수 없는지'를 지정하는 명령어입니다. 파일이 가질 수 있는 최대 권한은 rw-rw-rw- (666)이고, 디렉토리가 가질 수 있는 최대 권한은 rwxrwxrwx (777)입니다. umask는 여기서 어떠한 권한을 '빼줄 것인지'를 지정합니다. 

예시를 보면 쉽게 이해할 수 있습니다. 새로 만들어지는 디렉토리는 최대 권한인 rwxrwxrwx를 가지게 될 것입니다. 우리는 새로 만들어지는 디렉토리가 최대 권한이 아닌 rwxrw-r-- 권한을 가지도록 제한을 하고자 합니다.

- 우리가 원하는 것은 rwxrwxrwx를 rwxrw-r--로 제한하는 것입니다.
    - 즉, rwxrwxrwx에서 -----x-wx 만큼을 '제거해주면' 됩니다.
- 이 작업을 이진법으로 표기해보면,
    - 111 111 111 에서 000 001 011 만큼을 '빼주면' 됩니다.
    - 우리가 빼야 할 000 001 011을 팔진값으로 변환해보면 013이 됩니다.

즉, 새로 생성될 디렉토리의 기본 접근 권한을 rwxrw-r--로 제한하는 명령어는 umask 013이 됩니다. 

리눅스 시스템에서는 기본 접근 권한으로써 파일의 경우 rw-r--r-- (644)을, 디렉토리의 경우 rwxr-xr-x (755)를 가지고 있습니다. 파일이 가질 수 있는 최대 권한은 rw-rw-rw- (666)이고, 디렉토리가 가질 수 있는 최대 권한은 rwxrwxrwx (777)이라는 점을 비추어 볼 때, 리눅스 시스템에서는 umask의 기본값으로 022를 가지고 있음을 알 수 있습니다. 왜냐하면 저 기본 접근 권한은 파일과 디렉토리의 최대 권한에다가 ----w--w-를 '제거한' 권한이며, 이에 해당하는 이진값은 000 010 010이고 이를 팔진값으로 변환하면 022가 되기 때문입니다.

## 특수 접근 권한?

일반적으로 사용되는 권한 외에 특수한 권한도 있습니다. 이를 '특수 접근 권한'이라고 합니다. 상황에 따라 권한에는 약간의 유연성이 요구될 수 있습니다. 예를 들어 일반 사용자도 특정 실행 파일을 소유자의 권한으로 실행할 수 있어야 하는 경우가 있을 수 있습니다. 그리고 어떠한 디렉토리의 경우 공용 목적으로 사용하기 위해 누구든지 해당 디렉토리 안에다가 파일을 만들고 내용을 변경할 수 있지만, 해당 파일을 삭제하는 것은 그 파일을 만든 사람만 가능하도록 해야 할 상황이 있을 수 있습니다. 이처럼 특수한 상황을 위해 부여하는 특수한 권한이 '특수 접근 권한'입니다.

위에서는 권한에 대한 8진 표기법으로 세 자리의 숫자를 사용했는데, 실제로는 특수 접근 권한을 나타내는 숫자를 맨 앞에 추가해서 네 자리의 숫자로 이루어져 있습니다. 777이라는 권한을 완전하게 표기하면 0777이 되며, 특수 접근 권한을 가지지 않기(0) 때문에 생략이 가능했던 것입니다. 특수 접근 권한의 종류에 따라서 추가되는 표기가 달라지는데, 8진 표기법에서는 세 자리 팔진값 앞에 4, 2, 1 중 하나가 추가되며, 문자열 표기법에서는 소유자 또는 그룹의 실행 권한 x가 s로 대체되거나, 기타 사용자의 실행 권한 x가 t로 대체되게 됩니다. 자세한 사항은 아래에서 설명하겠습니다. 

### SetUID

SetUID란 set user identity라는 의미로, 실행 파일에다가 지정할 수 있는 특수 접근 권한 플래그입니다. 

리눅스 시스템은 사용자가 실행 파일을 실행할 때, 사용자에게 실행 권한이 허용된 경우에는 실행을 실제로 실시한 사용자의 real UID로써 실행을 합니다. 하지만 사용자에게 실행 권한이 허용되지 않았다면 시스템은 이 파일에 SetUID 비트가 존재하는지를 확인한 후, SetUID 비트가 발견되면 실행을 실시한 사용자가 아닌 실행 파일 소유주의 effective UID로써 파일을 실행하게 됩니다. 

이러한 원리로 인해 SetUID가 지정된 실행 파일은 '파일 소유자'의 권한으로 실행됩니다. 즉, 실행을 제외한 읽기와 쓰기는 원래의 권한 규정을 따르지만, 실행의 경우에만 사용자에게 '소유자'로써의 실행 권한을 임시로 부여해주는 것입니다.

root, 즉 슈퍼유저가 소유자인 실행 파일에 SetUID를 지정하는 경우, 일반 사용자에게도 SetUID의 특수 접근 권한을 통해 root 실행 권한이 주어지므로 보안이 크게 약화될 수 있습니다. 그래서 SetUID는 주로 일반 사용자들에게도 슈퍼유저의 실행 권한을 임시로 빌려줘야 하는 굉장히 제한적인 경우에만 사용되고, 그러한 예외적인 상황이 필요한 소수의 시스템 프로그램을 제외하고는 가급적 사용하지 않는 것이 좋습니다. 

SetUID가 적용된 대표적인 사례는 바로 사용자들이 패스워드를 변경하게 해주는 명령어인 passwd 입니다.

접근 권한을 나타내는 팔진값이 세 자리가 아닌 네 자리 숫자면서 첫 번째 숫자가 4인 실행 파일이 있다면(예: 4766), 그 파일에는 SetUID 플래그가 지정된 것입니다. 마찬가지로 만약 어떠한 실행 파일에 SetUID 플래그를 지정하고 싶다면 세 자리 팔진값 맨 앞에 4가 추가된 네 자리 팔진값을 사용하면(예: chmod 4777) 됩니다.

문자열로 표기한 접근 권한의 경우, 실행 파일에 SetUID 플래그가 설정되어 있다면 '소유자의 실행 권한'을 나타내는 글자가 x 대신 s로 나타납니다. 즉, rwxr--r--의 권한을 가진 실행 파일에 SetUID를 부여하게 되면 rwsr--r--로 나타나게 됩니다. 

### SetGID

SetGID란 set group identity라는 의미로, SetUID와 유사하지만 파일 소유자가 아닌 파일을 소유한 그룹의 권한으로 실행한다는 차이점이 있습니다. 

SetGID의 경우에는 세자리 권한 팔진값 맨 앞에 2가 추가됩니다. 문자열로 표기한 권한의 경우 '그룹의 실행 권한'을 나타내는 글자가 x 대신 s로 나타납니다. 즉, rwxr--r--의 권한을 가진 실행 파일에 SetGID를 부여하게 되면 rwxr-sr--로 나타나게 됩니다.

### 스티키 비트

스티키 비트(sticky bit)란 디렉토리에만 설정할 수 있는 특수 접근 권한입니다. 

디렉토리에 스티키 비트가 설정되게 되면 이 디렉토리 안에 누구나 파일이나 하위 디렉토리를 만들 수 있으며, 파일이나 하위 디렉토리를 만든 사용자가 그것의 소유자로써 지정됩니다. 파일을 만든 사용자가 아닌 다른 사용자는 해당 파일을 삭제할 수 없습니다. 

스티키 비트가 적용된 대표적인 사례는 바로 리눅스 시스템에서 임시 파일들을 보관하는 /tmp 디렉토리입니다. 

스티키 비트의 경우 세자리 권한 팔진값 맨 앞에 1이 추가됩니다. 문자열로 표기한 권한의 경우 '기타 사용자의 실행 권한'을 나타내는 글자가 x 대신 t로 나타납니다. 즉 drwxr--r--의 권한을 가진 디렉토리에 스티키 비트를 부여하게 되면 drwxr--r-t로 나타나게 됩니다.

---

본문은 다음의 자료들을 참고해서 공부를 한 내용이고, 저는 학생이다보니 틀린 내용이 있을 수 있습니다. 알려주시면 정정하도록 하겠습니다.

- RedHat Sysadmin. (n.d.). *[Linux permissions: An introduction to chmod](https://www.redhat.com/sysadmin/introduction-chmod)*.
- Oracle Corporation. (n.d.). [Chapter 4: Managing User Accounts and Groups (Overview) - Default File Permissions (umask)](https://docs.oracle.com/cd/E19683-01/817-3814/userconcept-95347/index.html). *Oracle System Administration Guide: Basic Administration*.
- SetUID. In *Wikipedia*.